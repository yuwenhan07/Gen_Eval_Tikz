\begin{tikzpicture}[x=1cm,y=1cm]
  % Parameters
  \def\cell{0.42}         % square cell size for the 16-position bars
  \def\cols{16}           % n = t^2 = 16
  \def\rowsPer{4}         % t = 4 agents per cohort
  \def\cohorts{4}         % 4 cohorts
  \def\rowsep{0.16}       % small vertical gap between consecutive rows
  \def\cohsep{0.40}       % extra gap between cohorts
  \def\xL{0}              % left x of long bars
  \pgfmathsetmacro{\W}{\cols*\cell}    % width of each long bar
  \pgfmathsetmacro{\Sgap}{0.50}        % horizontal gap before 17/18 column
  \pgfmathsetmacro{\xS}{\xL+\W+\Sgap}  % x of the 17/18 skinny column
  \pgfmathsetmacro{\wS}{0.30}          % width of the skinny 17/18 column (within a row)
  \pgfmathsetmacro{\xR}{\xS+\wS+0.55}  % x for right-hand braces/notes

  % Helper to compute baseline y of row r (1..16)
  % y(r) = - (r-1)*(cell+rowsep) - floor((r-1)/4)*cohsep
  \newcommand{\rowy}[1]{%
    {-(\cell+\rowsep)*((#1)-1) - \cohsep*int(((#1)-1)/\rowsPer)}%
  }

  % Shades: cohort C3 (rows 9..12)
  \begin{scope}
    \pgfmathsetmacro{\yTopCiii}{\rowy{9} + \cell}
    \pgfmathsetmacro{\yBotCiii}{\rowy{12}}
    \fill[gray!18] (\xL,\yBotCiii) rectangle ++(\W,\yTopCiii-\yBotCiii);
  \end{scope}

  % Draw the 16-position bars, mark top alternative, and place 11/12
  % Diagonal placement for 11/12 to visualize symmetry:
  % pos11(r) = 7 + int((r-1)/4) + ((r-1) mod 4)  -> stays within 1..16 for r=1..16
  \foreach \r in {1,...,16} {
    \pgfmathsetmacro{\y}{\rowy{\r}}
    % bar grid
    \draw (\xL,\y) rectangle ++(\W,\cell);
    \foreach \c in {0,...,15} {
      \draw (\xL+\c*\cell,\y) rectangle ++(\cell,\cell);
    }
    % top-ranked alternative (show the number inside the first cell)
    \node[font=\footnotesize] at (\xL+0.5*\cell,\y+0.5*\cell) {\r};

    % mark alternatives 11 and 12 (adjacent cells), diagonally across agents
    \pgfmathtruncatemacro{\blk}{int((\r-1)/4)}
    \pgfmathtruncatemacro{\off}{int(mod(\r-1,4))}
    \pgfmathtruncatemacro{\p}{7 + \blk + \off} % starting column for '11'
    \ifnum\p<\cols
      % Draw subtle frames around the two cells and put the numbers
      \draw[line width=0.4pt] (\xL+(\p-1)*\cell,\y) rectangle ++(\cell,\cell);
      \draw[line width=0.4pt] (\xL+\p*\cell,\y)     rectangle ++(\cell,\cell);
      \node[font=\scriptsize] at (\xL+(\p-0.5)*\cell,\y+0.5*\cell) {11};
      \node[font=\scriptsize] at (\xL+(\p+0.5)*\cell,\y+0.5*\cell) {12};
    \fi

    % show the 17/18 skinny column for two agents per cohort:
    % here we choose the 1st and 4th agent in each cohort (r=1,4,5,8,9,12,13,16)
    \ifnum\r=1\relax
      \draw (\xS,\y) rectangle ++(\wS,\cell);
      \draw (\xS,\y+0.5*\cell) -- ++(\wS,0);
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.75*\cell) {17};
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.25*\cell) {18};
    \fi
    \ifnum\r=4\relax
      \draw (\xS,\y) rectangle ++(\wS,\cell);
      \draw (\xS,\y+0.5*\cell) -- ++(\wS,0);
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.75*\cell) {17};
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.25*\cell) {18};
    \fi
    \ifnum\r=5\relax
      \draw (\xS,\y) rectangle ++(\wS,\cell);
      \draw (\xS,\y+0.5*\cell) -- ++(\wS,0);
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.75*\cell) {17};
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.25*\cell) {18};
    \fi
    \ifnum\r=8\relax
      \draw (\xS,\y) rectangle ++(\wS,\cell);
      \draw (\xS,\y+0.5*\cell) -- ++(\wS,0);
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.75*\cell) {17};
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.25*\cell) {18};
    \fi
    \ifnum\r=9\relax
      \draw (\xS,\y) rectangle ++(\wS,\cell);
      \draw (\xS,\y+0.5*\cell) -- ++(\wS,0);
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.75*\cell) {17};
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.25*\cell) {18};
    \fi
    \ifnum\r=12\relax
      \draw (\xS,\y) rectangle ++(\wS,\cell);
      \draw (\xS,\y+0.5*\cell) -- ++(\wS,0);
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.75*\cell) {17};
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.25*\cell) {18};
    \fi
    \ifnum\r=13\relax
      \draw (\xS,\y) rectangle ++(\wS,\cell);
      \draw (\xS,\y+0.5*\cell) -- ++(\wS,0);
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.75*\cell) {17};
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.25*\cell) {18};
    \fi
    \ifnum\r=16\relax
      \draw (\xS,\y) rectangle ++(\wS,\cell);
      \draw (\xS,\y+0.5*\cell) -- ++(\wS,0);
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.75*\cell) {17};
      \node[font=\scriptsize] at (\xS+0.5*\wS,\y+0.25*\cell) {18};
    \fi

    % agent labels on the far left:  \succ_r
    \node[anchor=east,inner sep=1pt] at (\xL-0.35,\y+0.5*\cell) {$\succ_{\r}$};
  }

  % Left curly braces for the 4 cohorts with labels C1..C4
  \foreach \c/\lab in {0/$C_1$,1/$C_2$,2/$C_3$,3/$C_4$} {
    \pgfmathtruncatemacro{\rTop}{\c*4+1}
    \pgfmathtruncatemacro{\rBot}{\c*4+4}
    \pgfmathsetmacro{\yTop}{\rowy{\rTop}+\cell}
    \pgfmathsetmacro{\yBot}{\rowy{\rBot}}
    \draw[decorate,decoration={brace,amplitude=3.5pt}]
      (\xL-0.55,\yTop) -- (\xL-0.55,\yBot)
        node[midway,left=3pt] {\lab};
  }

  % Right braces indicating the upper/lower halves of C3
  % Upper half: rows 9–10; Lower half: rows 11–12
  \draw[decorate,decoration={brace,amplitude=3.5pt}]
    (\xR,\rowy{9}+\cell) -- (\xR,\rowy{10})
      node[midway,right=3pt,align=left,font=\footnotesize] {Upper half of $C_3$};
  \draw[decorate,decoration={brace,amplitude=3.5pt}]
    (\xR,\rowy{11}+\cell) -- (\xR,\rowy{12})
      node[midway,right=3pt,align=left,font=\footnotesize] {Lower half of $C_3$};

  % Bottom braces with t and t^2
  \pgfmathsetmacro{\yBase}{\rowy{16}-0.55}
  \draw[decorate,decoration={brace,mirror,amplitude=3.5pt}]
    (\xL,\yBase) -- (\xL+\W,\yBase)
      node[midway,below=4pt] {$t$};
  \draw[decorate,decoration={brace,mirror,amplitude=3.5pt}]
    (\xS,\yBase) -- (\xS+\wS,\yBase)
      node[midway,below=4pt] {$t^2$};
\end{tikzpicture}